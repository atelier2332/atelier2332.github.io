<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outsider -- p r o t o t y p e</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">
    <style>
        html, body{
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Open Sans', sans-serif;
        }
        .background{
            width: 100%;
            height: 100%;
            background-color: rgb(211, 191, 12);
            position: absolute;
            z-index: -1;
        }
        .logo{
            position: absolute;
            top: 20px;
            left: 20px;
            width: 200px;
            font-size: 12px;
        }
        .logo img{
            width: 100%;
        }

        .tuto{
            position: absolute;
            top: 10px;
            right: 40px;            
            font-size: 20px;
            padding: 10px;
            border-radius: 10px;
            background-color: black;
            color: white;
        }
    </style>
</head>
<body>

    <div class="logo">
        <img src="outsider.svg" alt="Outsider">
        <p>p r o t o t y p e v0.2</p>
    </div>

    <div class="tuto">
        <p>
            Tutoriel: pour lancer des animations/samples, appuyez sur les touches "A, Z, E, R, T, Y".
        </p>
    </div>

    <div class="background"></div>

    <!-- <button class="start" id="bt-start">Start</button> -->

    <script src="node_modules/pixi.js/dist/pixi.min.js"></script>
    <script src="node_modules/animejs/lib/anime.min.js"></script>
    <script src="sound.js"></script>
    <script src="sound-loader.js"></script>
    <script>

        // todo: obj plutôt que array
        var animations = [
            {
                name: 'horse',
                pixiObject: null
            },
            {
                name: 'girl',
                pixiObject: null
            },
            {
                name: 'heart',
                pixiObject: null
            },
            {
                name: 'blengins',
                pixiObject: null
            },
            {
                name: 'cloudhorse',
                pixiObject: null
            },
            {
                name: 'girl2',
                pixiObject: null
            }
        ];

        // app
        // -------------
        const app = new PIXI.Application({
            autoResize: true,
            resolution: devicePixelRatio,
            transparent: true
        });
        document.body.appendChild(app.view);

        // resize
        // -------------
        //todo: remplacer tous les windows.innerwidth/height par des globales updatées ici
        window.addEventListener('resize', resize);
        function resize() {
            app.renderer.resize(window.innerWidth, window.innerHeight);
        }
        resize();

        // load
        // -------------
        animations.forEach(animation => {
            PIXI.Loader.shared.add(animation.name+'.json')
        });
        PIXI.Loader.shared.load(start);        

        // start
        // -------------
        function start() {

            // create pixi animations
            // -------------
            animations.forEach(animation => {
                let sheet = PIXI.Loader.shared.resources[animation.name+'.json'].spritesheet;
                animation.pixiObject = new PIXI.AnimatedSprite(sheet.animations[animation.name]);
                animation.pixiObject.animationSpeed = 0.5;
                app.stage.addChild(animation.pixiObject);
            });


            // INITS
            //
            animations[0].pixiObject.x = window.innerWidth - 200;
            animations[0].pixiObject.visible = false;
            //
            animations[1].pixiObject.y = window.innerHeight;
            animations[1].pixiObject.visible = false;
            //
            animations[2].pixiObject.x = 800;
            animations[2].pixiObject.y = -400;
            animations[2].pixiObject.visible = false;
            //
            animations[3].pixiObject.x = -800;
            animations[3].pixiObject.visible = false;
            //
            animations[4].pixiObject.x = -200;
            animations[4].pixiObject.y = 500;
            animations[4].pixiObject.visible = false;
            //
            //
            animations[5].pixiObject.x = -200;
            animations[5].pixiObject.y = 500;
            animations[5].pixiObject.visible = false;
        }

        var locked0 = false;
        var locked1 = false;
        var locked2 = false;
        var locked3 = false;
        var locked4 = false;
        var locked5 = false;

        var sounds = [];
        SoundLoader.init([
            "snd/9.wav",
            "snd/6.wav",
            "snd/15.wav",
            "snd/3.wav",
            "snd/10.wav",
            "snd/5.wav",
            "snd/13.wav", // backing 1
            "snd/14.wav" // backing 2
        ], function(snds, context){
            sounds = snds;
        });

        // document.getElementById('bt-start').addEventListener('click', function(){
        //     // backing
        //     sounds[6].play(1, 0, true);
        // });

        //keyboard
        // -------------
        document.addEventListener('keydown', logKey);
        function logKey(e) {
            //todo: créer un fonction qui va taper dans un obj
            // créer les ensembles sous forme de collection d'obj
            switch (e.code) {

                //horse
                case 'KeyQ':
                    if(!locked0){                       
                        animations[0].pixiObject.x = window.innerWidth - 500;
                        sounds[0].play();

                        anime({
                            targets: animations[0].pixiObject,
                            x: -800,
                            y: Math.random() * 200,
                            easing: 'linear',
                            duration: 4000,
                            begin: function(){
                                animations[0].pixiObject.play();
                                animations[0].pixiObject.visible = true;
                            },
                            complete: function(){
                                animations[0].pixiObject.stop();
                                animations[0].pixiObject.visible = false;
                                locked0 = false;
                            }
                        });

                        // anime({
                        //     targets: '.background',
                        //     backgroundColor: 'rgb('+Math.random()*255+', '+Math.random()*255+', '+Math.random()*255+')',
                        //     duration: 2000,
                        //     easing: 'easeInOutQuad'
                        // });
                    }
                    locked0 = true;

                    break;

                //girl
                case 'KeyW':
                    if(!locked1){
                        animations[1].pixiObject.y = window.innerHeight - 100;
                        sounds[1].play();

                        anime({
                            targets: animations[1].pixiObject,
                            x: Math.random() * 100,
                            y: 300,
                            easing: 'easeOutSine',
                            duration: 2000,
                            begin: function(){
                                animations[1].pixiObject.play();
                                animations[1].pixiObject.visible = true;
                            },
                            complete: function(){
                                animations[1].pixiObject.stop();
                                animations[1].pixiObject.visible = false;
                                locked1 = false;
                            }
                        });
                    }
                    locked1 = true;                
                    break;

                //heart
                case 'KeyE':
                    if(!locked2){            
                        animations[2].pixiObject.x = 800;
                        animations[2].pixiObject.y = -300;
                        sounds[2].play();

                        anime({
                            targets: animations[2].pixiObject,
                            //x: Math.random() * 200,
                            y: Math.random() * 400,
                            //tint: 0x07ff41,
                            easing: 'easeOutSine',
                            duration: 1500,
                            begin: function(){
                                animations[2].pixiObject.play();
                                animations[2].pixiObject.visible = true;
                            },
                            complete: function(){
                                animations[2].pixiObject.stop();
                                animations[2].pixiObject.visible = false;
                                locked2 = false;
                            }
                        });
                    }
                    locked2 = true;
                    break;

                //blengins
                case 'KeyR':
                    if(!locked3){             
                        animations[3].pixiObject.x = -200;
                        sounds[3].play();

                        anime({
                            targets: animations[3].pixiObject,
                            x: window.innerWidth,
                            y: Math.random() * 200,
                            easing: 'easeOutSine',
                            duration: 2500,
                            begin: function(){
                                animations[3].pixiObject.play();
                                animations[3].pixiObject.visible = true;
                            },
                            complete: function(){
                                animations[3].pixiObject.stop();
                                animations[3].pixiObject.visible = false;
                                locked3 = false;
                            }
                        });
                    }
                    locked3 = true;                
                    break;

                //cloud
                case 'KeyT':
                    if(!locked4){                    
                        animations[4].pixiObject.x = -200;
                        animations[4].pixiObject.y = 500;
                        sounds[4].play();

                        anime({
                            targets: animations[4].pixiObject,
                            x: 800,
                            y: Math.random() * 200,
                            easing: 'easeInOutQuad',
                            duration: 2400,
                            begin: function(){
                                animations[4].pixiObject.play();
                                animations[4].pixiObject.visible = true;
                            },
                            complete: function(){
                                animations[4].pixiObject.stop();
                                animations[4].pixiObject.visible = false;
                                locked4 = false;
                            }
                        });
                    }
                    locked4 = true;                  
                    break;

                // girl 2
                case 'KeyY':
                    if(!locked5){                    
                        animations[5].pixiObject.x = -200;
                        animations[5].pixiObject.y = 500;
                        sounds[5].play();

                        anime({
                            targets: animations[5].pixiObject,
                            x: window.innerWidth,
                            y: Math.random() * 200,
                            easing: 'easeInOutQuad',
                            duration: 3500,
                            begin: function(){
                                animations[5].pixiObject.play();
                                animations[5].pixiObject.visible = true;
                            },
                            complete: function(){
                                animations[5].pixiObject.stop();
                                animations[5].pixiObject.visible = false;
                                locked5 = false;
                            }
                        });
                    }
                    locked5 = true;  
                    break;
            
                default:
                    break;
            }
        }
        
    </script>
</body>
</html>